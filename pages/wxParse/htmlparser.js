function e(g){for(var b={},f=g.split(","),d=0;d<f.length;d++){b[f[d]]=!0}return b}var t=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,s=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,a=e("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),n=e("a,address,code,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),i=e("abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),o=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),l=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),c=e("wxxxcode-style,script,style,view,scroll-view,block");module.exports=function(x,y){function w(g,b){if(b){for(b=b.toLowerCase(),f=z.length-1;f>=0&&z[f]!=b;f--){}}else{var f=0}if(f>=0){for(var d=z.length-1;d>=f;d--){y.end&&y.end(z[d])}z.length=f}}var j,A,q,z=[],k=x;for(z.last=function(){return this[this.length-1]};x;){if(A=!0,z.last()&&c[z.last()]){x=x.replace(new RegExp("([\\s\\S]*?)</"+z.last()+"[^>]*>"),function(d,b){return b=b.replace(/<!--([\s\S]*?)-->|<!\[CDATA\[([\s\S]*?)]]>/g,"$1$2"),y.chars&&y.chars(b),""}),w(0,z.last())}else{if(0==x.indexOf("\x3c!--")?(j=x.indexOf("--\x3e"))>=0&&(y.comment&&y.comment(x.substring(4,j)),x=x.substring(j+3),A=!1):0==x.indexOf("</")?(q=x.match(r))&&(x=x.substring(q[0].length),q[0].replace(r,w),A=!1):0==x.indexOf("<")&&(q=x.match(t))&&(x=x.substring(q[0].length),q[0].replace(t,function(g,b,d,h){if(b=b.toLowerCase(),n[b]){for(;z.last()&&i[z.last()];){w(0,z.last())}}if(o[b]&&z.last()==b&&w(0,b),(h=a[b]||!!h)||z.push(b),y.start){var f=[];d.replace(s,function(u,m){var p=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:l[m]?m:"";f.push({name:m,value:p,escaped:p.replace(/(^|[^\\])"/g,'$1\\"')})}),y.start&&y.start(b,f,h)}}),A=!1),A){j=x.indexOf("<");for(var v="";0===j;){v+="<",j=(x=x.substring(1)).indexOf("<")}v+=j<0?x:x.substring(0,j),x=j<0?"":x.substring(j),y.chars&&y.chars(v)}}if(x==k){throw"Parse Error: "+x}k=x}w()};