function e(h){for(var b={},g=h.split(","),f=0;f<g.length;f++){b[g[f]]=!0}return b}function t(b){return b.replace(/<\?xml.*\?>\n/,"").replace(/<.*!doctype.*\>\n/,"").replace(/<.*!DOCTYPE.*\>\n/,"")}function r(k){var g=[];if(0==a.length||!n){return(m={}).node="text",m.text=k,h=[m]}k=k.replace(/\[([^\[\]]+)\]/g,":$1:");for(var j=new RegExp("[:]"),h=k.split(j),f=0;f<h.length;f++){var b=h[f],m={};n[b]?(m.node="element",m.tag="emoji",m.text=n[b],m.baseSrc=o):(m.node="text",m.text=b),g.push(m)}return g}var s="https",a="",o="",n={},i=require("./wxDiscode.js"),l=require("./htmlparser.js"),d=(e("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),e("br,a,code,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video")),c=e("abbr,acronym,applet,b,basefont,bdo,big,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),u=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),e("wxxxcode-style,script,style,view,scroll-view,block");module.exports={html2json:function(f,b){f=t(f),f=i.strDiscode(f);var g=[],h={node:b,nodes:[],images:[],imageUrls:[]};return l(f,{start:function(A,C,j){var w={node:"element",tag:A};if(d[A]?w.tagType="block":c[A]?w.tagType="inline":u[A]&&(w.tagType="closeSelf"),0!==C.length&&(w.attr=C.reduce(function(D,m){var v=m.name,p=m.value;return"class"==v&&(console.dir(p),w.classStr=p),"style"==v&&(console.dir(p),w.styleStr=p),p.match(/ /)&&(p=p.split(" ")),D[v]?Array.isArray(D[v])?D[v].push(p):D[v]=[D[v],p]:D[v]=p,D},{})),"img"===w.tag){w.imgIndex=h.images.length;var k=w.attr.src;k=i.urlToHttpUrl(k,s),w.attr.src=k,w.from=b,h.images.push(w),h.imageUrls.push(k)}if("font"===w.tag){var q=["x-small","small","medium","large","x-large","xx-large","-webkit-xxx-large"],z={color:"color",face:"font-family",size:"font-size"};w.attr.style||(w.attr.style=[]),w.styleStr||(w.styleStr="");for(var x in z){if(w.attr[x]){var y="size"===x?q[w.attr[x]-1]:w.attr[x];w.attr.style.push(z[x]),w.attr.style.push(y),w.styleStr+=z[x]+": "+y+";"}}}if("source"===w.tag&&(h.source=w.attr.src),j){var B=g[0]||h;void 0===B.nodes&&(B.nodes=[]),B.nodes.push(w)}else{g.unshift(w)}},end:function(m){var j=g.shift();if(j.tag!==m&&console.error("invalid state: mismatch end tag"),"video"===j.tag&&h.source&&(j.attr.src=h.source,delete result.source),0===g.length){h.nodes.push(j)}else{var k=g[0];void 0===k.nodes&&(k.nodes=[]),k.nodes.push(j)}},chars:function(m){var j={node:"text",text:m,textArray:r(m)};if(0===g.length){h.nodes.push(j)}else{var k=g[0];void 0===k.nodes&&(k.nodes=[]),k.nodes.push(j)}},comment:function(j){}}),h},emojisInit:function(){var g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/wxParse/emojis/",f=arguments[2];a=g,o=b,n=f}};